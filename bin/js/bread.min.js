function breadViewer(e){function t(){return n.render()}function a(t){if(this.$el=t,this.$el.on("click",'[data-event="delete"]',function(e){var t=_.indexOf(_.pluck(this.models,"id"),e.currentTarget.dataset.id);confirm("Are you sure you want to delete? \nThis operation can not be undone.\n\n"+_.values(this.models[t].attributes).join("\n"))&&("function"==typeof this.options.delete&&this.options.delete(this.models[t]),this.models.splice(t,1),this.draw())}.bind(this)),t.find(".form").length&&(this.berry=t.find(".form").berry({attributes:e,inline:!0,actions:!1,fields:[{label:"Entries per page",name:"count",type:"select","default":{label:"All",value:1e4},options:e.entries||[25,50,100],columns:2},{label:!1,name:"reset",type:"raw",value:'<button data-event="add" class="btn btn-success pull-right btn-sm" style="margin-top: 30px;"><i class="fa fa-pencil-square-o"></i> Create New</button>',columns:2,offset:8}]}).on("change:count",function(){$.extend(e,this.berry.toJSON()),e.count=parseInt(e.count,10),this.draw()},this)),t.find(".filter").length&&(this.filter=t.find(".filter").berry({name:"filter",renderer:"inline",attributes:this.defaults,disableMath:!0,suppress:!0,fields:e.filterFields}).on("change",function(){this.draw()},this)),e.data)for(var a in e.data)this.models.push(new tableModel(this,e.data[a]));this.$el.on("click","[data-page]",s.bind(this)),this.$el.on("click","[data-sort]",i.bind(this)),this.$el.on("click",'[name="reset-search"]',function(){l.call(this.filter,this.defaults),this.draw()}.bind(this)),this.$el.find('[data-event="add"]').on("click",$.proxy(function(){$().berry($.extend(!0,{},{name:"modal",legend:'<i class="fa fa-pencil-square-o"></i> Create New',fields:e.schema},e.berry||{})).on("save",function(){if(Berries.modal.validate()){var e=new tableModel(this,Berries.modal.toJSON());this.models.push(e),Berries.modal.trigger("saved"),this.draw(),"function"==typeof this.options.add&&this.options.add(e)}},this)},this)),this.draw()}this.draw=function(){e.search=_.compactObject(this.filter.toJSON()),this.search(e);var t={};e.pagecount=Math.ceil(this.lastGrabbed/e.count),t.pages=[],e.page>e.pagecount&&(e.page=e.pagecount||1);var a=this.lastGrabbed>e.count*e.page?e.count*e.page:this.lastGrabbed,s=$('<tbody class="list-group">');_.each(this.grab(e),function(e){new viewitem({model:e,container:s,summary:r})});var i=(this.$el.find(".list-group").empty().replaceWith(s),e.page-2);1>i&&(i=1);var n=e.page+2;n>e.pagecount&&(n=e.pagecount);for(var l=i;n>=l;l++){var o={name:l};e.page==l&&(o.active="active"),t.pages.push(o)}t.size=this.lastGrabbed,t.last=a,t.first=e.count*(e.page-1)+1,this.$el.find(".paginate-footer").html(templates.table_footer.render(t,templates))};var s=function(t){t.stopPropagation(),t.preventDefault(),"inc"==$(t.currentTarget).data("page")?(e.page++,e.page>e.pagecount&&(e.page=e.pagecount)):"dec"==$(t.currentTarget).data("page")?(e.page--,e.page<1&&(e.page=1)):e.page=$(t.currentTarget).data("page")||e.pagecount,this.draw()},i=function(t){t.stopPropagation(),t.preventDefault(),$(t.currentTarget).siblings("[data-sort]").removeClass("text-primary"),$(t.currentTarget).siblings("[data-sort]").find("i").attr("class","fa fa-sort"),$(t.currentTarget).addClass("text-primary"),e.reverse=e.sort==$(t.currentTarget).data("sort")?!e.reverse:!1,e.reverse?$(t.currentTarget).find("i").attr("class","fa fa-sort-asc"):$(t.currentTarget).find("i").attr("class","fa fa-sort-desc"),e.sort=$(t.currentTarget).data("sort"),this.draw()},e=$.extend({count:e.count||25,page:1,sort:"createdAt",reverse:!1},e);e.schema=_.map(_.map(e.schema,Berry.processOpts),function(e){return e.value=e.value||e.default,delete e.default,e}),e.filterFields=_.map($.extend(!0,{},e.filters||e.schema),function(e){switch(e=Berry.normalizeItem(e),name=e.name,e.type){case"textarea":case"contenteditable":case"ace":case"color":case"date":e.type="text";break;case"checkbox":e.choices=[{label:e.falsestate||"False",value:e.falsestate||"false"},{label:e.truestate||"True",value:e.truestate||"True"}];case"radio":e.type="select";case"select":e.default={label:"No Filter",value:""},e.value=""}return e.options&&(e.options=_.map(e.options,function(e){return _.omit(e,"selected")})),e.id=e.id||Berry.getUID(),e.search=e.name,e.name=e.id,e.show={},e.isEnabled=!0,e}),"object"==typeof e.columns&&(e.filterFields=_.filter(e.filterFields,function(t){return _.contains(e.columns,t.name)||_.contains(e.columns,t.id)}));var r={start:"{{",end:"}}",items:_.map(e.filterFields,function(t){var a=t.search||t.label.split(" ").join("_").toLowerCase();switch(t.type){case"date":a='<span data-moment="{{attributes.'+a+'}}" data-format="L"></span>';break;case"select":a=e.inlineEdit?'<span data-popins="'+a+'"></span>':"{{attributes."+a+"}}";break;case"color":a='<div class="btn btn-default" style="background-color:{{attributes.'+a+'}}">{{attributes.'+a+"}}</div> {{attributes."+a+"}}";break;default:a="{{attributes."+a+"}}"}return{label:t.label,name:a,cname:t.name||t.label.split(" ").join("_").toLowerCase(),id:t.id,visible:!("hidden"==t.type)}})},n=Hogan.compile(templates.table.render(r,templates));this.defaults={},_.map(e.filterFields,function(e){switch(e.type){case"text":e.value="";break;case"checkbox":e.value="false";case"radio":e.value="";case"select":e.value=""}this.defaults[e.name]=e.value}.bind(this));var l=function(e){this.each(function(e){this.isContainer||this.setValue(Berry.search(e,this.getPath()))},[e],this.fields)};this.search=function(e){var t=_.sortBy(this.models,function(t){return t.attributes[e.sort]});e.reverse||(t=t.reverse()),filterMap=this.filterMap,t=_.filter(t,function(t){var a=$.isEmptyObject(e.search);for(var s in e.search){var i;if(i="undefined"==typeof _.where(e.filterFields,{id:s})[0].options?$.score((t.attributes[this.filterMap[s]]+"").replace(/\s+/g," ").toLowerCase(),(e.search[s]+"").toLowerCase())>.4:t.attributes[this.filterMap[s]]+""==e.search[s]+"",a=i,!a)break}return a}),this.lastGrabbed=t.length,this.filtered=t},this.grab=function(e){return this.filtered.slice(e.count*(e.page-1),e.count*(e.page-1)+e.count)},this.models=[],this.options=e,this.filterMap={},_.map(e.filterFields,function(e){this.filterMap[e.id]=e.search}.bind(this));$(e.container).html(t.call(this)),a.call(this,$(e.container)),this.getCSV=function(){csvify(_.map(this.filtered,function(e){return e.attributes}),_.pluck(this.options.schema,"name"))}} _.mixin({compactObject:function(e){return _.each(e,function(t,n){t||0===t||delete e[n]}),e}}),function(e){e.score=function(t,n,r){if(0===n.length)return.9;if(n.length>t.length)return 0;for(var i=n.length;i>0;i--){var c=n.substring(0,i),o=t.indexOf(c);if(!(0>o||o+n.length>t.length+r)){var u=t.substring(o+c.length),a=null;a=i>=n.length?"":n.substring(i);var l=e.score(u,a,r+o);if(l>0){var f=t.length-u.length;if(0!==o){var h=t.charCodeAt(o-1);if(32==h||9==h)for(var s=o-2;s>=0;s--)h=t.charCodeAt(s),f-=32==h||9==h?1:.15;else f-=o}return f+=l*u.length,f/=t.length}}}return 0}}(jQuery),csvify=function(e,t){var n='"'+t.join('", "')+'"\n';n+=e.map(function(e){return JSON.stringify(values(e))}).join("\n").replace(/(^\[)|(\]$)/gm,"");var r=document.createElement("a");r.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(n)),r.setAttribute("download","customers.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}; function tableModel(t,e){this.owner=t,this.id=Berry.getUID(),this.attributes={},this.schema=t.options.schema,this.set=function(t){this.attributes=t},$.extend(!0,this.attributes,e),this.toJSON=function(){return this.attributes}}tableModel.prototype.events={initialize:[]},tableModel.prototype.addSub=Berry.prototype.addSub,tableModel.prototype.on=Berry.prototype.on,tableModel.prototype.off=Berry.prototype.off,tableModel.prototype.trigger=Berry.prototype.trigger; function viewitem(t){this.update=function(){"undefined"!=typeof this.berry&&this.berry.destroy(),this.$el.find("[data-event]").off(),this.$el.replaceWith(this.setElement(this.view.render(this.model,templates)).$el),this.$el.find("[data-popins]").length>0&&(this.berry=this.$el.berry({popins:{container:"#first",viewport:{selector:"body",padding:20}},renderer:"popins",model:this.model}));var t=[];this.$el.find("[data-event]").each(function(){t.push($(this).data("event"))}),this.$el.find('[data-event="delete"]'),this.$el.find('[data-event="edit"]').on("click",$.proxy(function(){$().berry($.extend(!0,{},{name:"modal",legend:'<i class="fa fa-pencil-square-o"></i> Edit',model:this.model},this.model.owner.options.berry||{})).on("saved",function(){"function"==typeof this.model.owner.options.edit&&this.model.owner.options.edit(this.model),this.update()},this)},this)),this.$el.find("[data-moment]").each(function(){$(this).html(moment.utc($(this).data("moment")).format($(this).data("format")))}),this.$el.find(".sparkline").each(function(){$(this).peity($(this).data("type"),{radius:$(this).data("radius")})})},this.view=Hogan.compile(templates.table_row.render(t.summary,templates)),this.setElement=function(t){return this.$el=$(t),this},this.model=t.model,this.$el=$("<tr>"),t.container&&t.container.append(this.$el),this.model.on("change",this.update,this),this.model.on("destroy",$.proxy(function(){this.$el.fadeOut("fast",$.proxy(function(){this.remove()},this))},this)),this.update()} if(!templates)var templates={};templates.table=new Hogan.Template({code:function(a,t,b){var n=this;return n.b(b=b||""),n.b('<div class="well" style="background:#fff">'),n.b("\n"+b),n.b('	<div class="form"></div>		'),n.b("\n"+b),n.b('	<div class="paginate-footer" style="overflow:hidden"></div>'),n.b("\n"+b),n.b('	<div class="table-responsive">'),n.b("\n"+b),n.b('	<table class="table table-bordered table-striped table-hover dataTable">'),n.b("\n"+b),n.b("		<thead>"),n.b("\n"+b),n.b('			<tr style="background:#fff;cursor:pointer" class="noselect">'),n.b("\n"+b),n.b("				"),n.s(n.f("items",a,t,1),a,t,0,326,481,"{{ }}")&&(n.rs(a,t,function(a,t,b){b.s(b.f("visible",a,t,1),a,t,0,338,469,"{{ }}")&&(b.rs(a,t,function(a,t,b){b.b('<th data-sort="'),b.b(b.v(b.f("cname",a,t,0))),b.b('"><h6 style="margin: 2px;font-size:13px;white-space: nowrap"><i class="fa fa-sort"></i> '),b.b(b.v(b.f("label",a,t,0))),b.b("</h6></th>")}),a.pop())}),a.pop()),n.b("\n"+b),n.b('				<th style="width: 100px;">Actions</th>'),n.b("\n"+b),n.b("			</tr>				"),n.b("\n"+b),n.b('			<tr style="background:#fff;" class="filter">'),n.b("\n"+b),n.b("				"),n.s(n.f("items",a,t,1),a,t,0,610,679,"{{ }}")&&(n.rs(a,t,function(a,t,b){b.s(b.f("visible",a,t,1),a,t,0,622,667,"{{ }}")&&(b.rs(a,t,function(a,t,b){b.b('<td data-inline="'),b.b(b.v(b.f("cname",a,t,0))),b.b('" id="'),b.b(b.v(b.f("id",a,t,0))),b.b('"></td>')}),a.pop())}),a.pop()),n.b("\n"+b),n.b('				<th><button name="reset-search" class="btn btn-warning btn-sm"><i class="fa fa-filter"></i> Reset</button></th>'),n.b("\n"+b),n.b("			</tr>"),n.b("\n"+b),n.b("		</thead>"),n.b("\n"+b),n.b('		<tbody class="list-group">'),n.b("\n"+b),n.b("			<tr><td>"),n.b("\n"+b),n.b('				<div class="alert alert-info" role="alert">You have no items.</div>'),n.b("\n"+b),n.b("			</td></tr>"),n.b("\n"+b),n.b("		</tbody>"),n.b("\n"+b),n.b("	</table>"),n.b("\n"+b),n.b("</div>"),n.b("\n"+b),n.b('	<div class="paginate-footer" style="overflow:hidden"></div>'),n.b("\n"+b),n.b("<div>"),n.fl()},partials:{},subs:{}}),templates.table_footer=new Hogan.Template({code:function(a,t,b){var n=this;return n.b(b=b||""),n.b("<div>"),n.b("\n"+b),n.b('	<nav class="pull-right">'),n.b("\n"+b),n.s(n.f("size",a,t,1),a,t,0,42,751,"{{ }}")&&(n.rs(a,t,function(a,t,n){n.b('		<ul class="pagination" style="margin:0">'),n.b("\n"+b),n.b('			<li class="pagination-first"><a data-page="1" href="javascript:void(0);" aria-label="First"><span aria-hidden="true">&laquo;</span></a></li>'),n.b("\n"+b),n.b('			<li><a data-page="dec" href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&lsaquo;</span></a></li>'),n.b("\n"+b),n.s(n.f("pages",a,t,1),a,t,0,368,468,"{{ }}")&&(n.rs(a,t,function(a,t,n){n.b('				<li class="'),n.b(n.v(n.f("active",a,t,0))),n.b('"><a data-page="'),n.b(n.v(n.f("name",a,t,0))),n.b('" href="javascript:void(0);">'),n.b(n.v(n.f("name",a,t,0))),n.b("</a></li>"),n.b("\n"+b)}),a.pop()),n.b('			<li><a data-page="inc" href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&rsaquo;</span></a></li>'),n.b("\n"+b),n.b('			<li class="pagination-last"><a data-page="" href="javascript:void(0);" aria-label="Last"><span aria-hidden="true">&raquo;</span></a></li>'),n.b("\n"),n.b("\n"+b),n.b("		</ul>"),n.b("\n"+b)}),a.pop()),n.b("	</nav>"),n.b("\n"+b),n.b('	<h5 class="range">'),n.s(n.f("size",a,t,1),a,t,0,797,846,"{{ }}")&&(n.rs(a,t,function(a,t,b){b.b("Showing "),b.b(b.v(b.f("first",a,t,0))),b.b(" to "),b.b(b.v(b.f("last",a,t,0))),b.b(" of "),b.b(b.v(b.f("size",a,t,0))),b.b(" results")}),a.pop()),n.s(n.f("size",a,t,1),a,t,1,0,0,"")||n.b("No matching entries"),n.b("</h5>"),n.b("\n"),n.b("\n"+b),n.b("</div>"),n.fl()},partials:{},subs:{}}),templates.table_row=new Hogan.Template({code:function(a,t,b){var n=this;return n.b(b=b||""),n.b('<tr class="filterable">'),n.b("\n"+b),n.s(n.f("items",a,t,1),a,t,0,35,82,"{{ }}")&&(n.rs(a,t,function(a,t,n){n.b("	"),n.s(n.f("visible",a,t,1),a,t,0,49,68,"{{ }}")&&(n.rs(a,t,function(a,t,b){b.b("<td>"),b.b(b.t(b.f("name",a,t,0))),b.b("</td>")}),a.pop()),n.b("\n"+b)}),a.pop()),n.b('	<td style="min-width:100px">'),n.b("\n"+b),n.b('		<div class="btn-group">'),n.b("\n"+b),n.b('		  <button type="button" class="btn btn-xs btn-info go">Actions</button>'),n.b("\n"+b),n.b('		  <button type="button" class="btn btn-xs btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),n.b("\n"+b),n.b('		    <span class="caret"></span>'),n.b("\n"+b),n.b('		    <span class="sr-only">Toggle Dropdown</span>'),n.b("\n"+b),n.b("		  </button>"),n.b("\n"+b),n.b('		  <ul class="dropdown-menu dropdown-menu-right">'),n.b("\n"+b),n.b('		    <li><a href="javascript:void(0);" data-event="edit" data-id="'),n.b(n.v(n.f("start",a,t,0))),n.b("id"),n.b(n.v(n.f("end",a,t,0))),n.b('"><i class="fa fa-pencil"></i> Edit</a></li>'),n.b("\n"+b),n.b('		    <li><a href="javascript:void(0);" data-event="delete" data-id="'),n.b(n.v(n.f("start",a,t,0))),n.b("id"),n.b(n.v(n.f("end",a,t,0))),n.b('"><i class="fa fa-times"></i> Delete</a></li>'),n.b("\n"+b),n.b("		  </ul>"),n.b("\n"+b),n.b("		</div>"),n.b("\n"+b),n.b("	</td>"),n.b("\n"+b),n.b("</tr>"),n.fl()},partials:{},subs:{}});
